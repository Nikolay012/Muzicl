import os
import logging
from telegram import Update, ReplyKeyboardMarkup, ReplyKeyboardRemove
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes, ConversationHandler
from collections import Counter
from typing import List, Dict
import json
from datetime import datetime

try:
    from music_analyzer import MusicTasteAnalyzer, Track, MoodCategory, Genre
except ImportError:
    from typing import List
    from dataclasses import dataclass
    from enum import Enum

    class MoodCategory(Enum):
        HAPPY = "happy"
        SAD = "sad"
        ENERGETIC = "energetic"
        CALM = "calm"
        NEUTRAL = "neutral"

    class Genre(Enum):
        POP = "pop"
        ROCK = "rock"
        HIP_HOP = "hip-hop"
        ELECTRONIC = "electronic"
        RNB = "r&b"
        INDIE = "indie"
        JAZZ = "jazz"
        CLASSICAL = "classical"
        UNKNOWN = "unknown"

    @dataclass
    class Track:
        name: str
        artist: str
        duration_ms: int
        valence: float
        energy: float
        danceability: float
        acousticness: float = 0.0
        instrumentalness: float = 0.0
        tempo: float = 120.0
        loudness: float = -10.0
        key: int = 0
        mode: int = 1
        genre: str = None
