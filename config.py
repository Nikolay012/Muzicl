import os
from enum import Enum

TELEGRAM_TOKEN = os.getenv('TELEGRAM_BOT_TOKEN', '')

SPOTIFY_CLIENT_ID = os.getenv('SPOTIFY_CLIENT_ID', '')
SPOTIFY_CLIENT_SECRET = os.getenv('SPOTIFY_CLIENT_SECRET', '')
YANDEX_MUSIC_TOKEN = os.getenv('YANDEX_MUSIC_TOKEN', '')

BOT_NAME = "Music Taste Analyzer"
BOT_VERSION = "2.0"
DEFAULT_LANGUAGE = "ru"
REQUEST_TIMEOUT = 30
PLAYLIST_FETCH_TIMEOUT = 45
MAX_PLAYLIST_SIZE = 500
CACHE_TTL = 3600

MOOD_EMOJIS = {
    'happy': 'üòä',
    'sad': 'üò¢',
    'energetic': '‚ö°',
    'calm': 'üòå',
    'romantic': '‚ù§Ô∏è',
    'angry': 'üò†',
    'neutral': 'üòê'
}

GENRE_COLORS = {
    'pop': '#FF6B6B',
    'rock': '#4ECDC4',
    'hiphop': '#45B7D1',
    'electronic': '#96CEB4',
    'jazz': '#FECA57',
    'classical': '#FF9FF3',
    'metal': '#54A0FF',
    'reggae': '#5F27CD',
    'country': '#FF9F43',
    'rnb': '#00D2D3'
}

# ==================== –°–û–û–ë–©–ï–ù–ò–Ø –ò –¢–ï–ö–°–¢–´ ====================
MESSAGES = {
    'welcome': (
        "*–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ {bot_name}!*\n\n"
        "–Ø –ø–æ–º–æ–≥—É –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–≤–æ–∏ –º—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –≤–∫—É—Å—ã, "
        "–Ω–∞–π—Ç–∏ –ø–æ—Ö–æ–∂–∏–µ —Ç—Ä–µ–∫–∏ –∏ –æ—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—É—é –º—É–∑—ã–∫—É.\n\n"
        "*–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:*\n"
        "‚Ä¢ –ê–Ω–∞–ª–∏–∑ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤\n"
        ‚Ä¢ –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å\n"
        ‚Ä¢ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n"
        ‚Ä¢ *–ù–û–í–û–ï* –ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –±–∏—Ç–≤—ã \n"
        ‚Ä¢ –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
    ),
    
    'help': (
        "*–ü–æ–º–æ—â—å –ø–æ –∫–æ–º–∞–Ω–¥–∞–º:*\n\n"
        "*/start* - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É\n"
        "*/help* - –≠—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞\n"
        "*/analyze [—Å—Å—ã–ª–∫–∞]* - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç\n"
        "*/profile* - –ú–æ–π –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å\n"
        "*/recommend* - –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏\n"
        "*/battle [@username]* - –ù–∞—á–∞—Ç—å –º—É–∑—ã–∫–∞–ª—å–Ω—É—é –±–∏—Ç–≤—É\n"
        "*/stats* - –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\n"
        "*/cancel* - –û—Ç–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ\n\n"
        "*–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:*\n"
        "1. –û—Ç–ø—Ä–∞–≤—å —Å—Å—ã–ª–∫—É –Ω–∞ –ø–ª–µ–π–ª–∏—Å—Ç (Spotify/Yandex)\n"
        "2. –ü–æ–ª—É—á–∏ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑\n"
        "3. –ò—Å–ø–æ–ª—å–∑—É–π –∫–Ω–æ–ø–∫–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏"
    ),
    
    'playlist_prompt': (
        "*–û—Ç–ø—Ä–∞–≤—å —Å—Å—ã–ª–∫—É –Ω–∞ –ø–ª–µ–π–ª–∏—Å—Ç:*\n\n"
        "–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è:\n"
        "‚Ä¢ Spotify\n"
        "‚Ä¢ –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∞\n"
        "‚Ä¢ Apple Music (—Å–∫–æ—Ä–æ)\n\n"
        "–ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Å—ã–ª–æ–∫ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é!"
    ),
    
    'analysis_complete': (
        "*–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω!*\n\n"
        "*–û—Å–Ω–æ–≤–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:*\n"
        "‚Ä¢ –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: {mood}\n"
        "‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è: {energy}/10\n"
        "‚Ä¢ –¢–∞–Ω—Ü–µ–≤–∞–ª—å–Ω–æ—Å—Ç—å: {danceability}/10\n"
        "‚Ä¢ –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å: {popularity}/100\n\n"
        "*–¢–æ–ø-3 –∂–∞–Ω—Ä–∞:*\n{genres}\n\n"
        "*–°–∞–º—ã–π —á–∞—Å—Ç—ã–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:* {top_artist}\n"
        "*–°–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π —Ç—Ä–µ–∫:* {top_track}"
    ),
    
    'battle_invite': (
        "*–ú—É–∑—ã–∫–∞–ª—å–Ω–∞—è –±–∏—Ç–≤–∞!*\n\n"
        "{user1} –≤—ã–∑—ã–≤–∞–µ—Ç {user2} –Ω–∞ –º—É–∑—ã–∫–∞–ª—å–Ω—É—é –¥—É—ç–ª—å!\n\n"
        "–ü—Ä–∞–≤–∏–ª–∞:\n"
        "1. –ö–∞–∂–¥—ã–π –≤—ã–±–∏—Ä–∞–µ—Ç 3 –ª—É—á—à–∏—Ö —Ç—Ä–µ–∫–∞\n"
        "2. –ë–æ—Ç —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –ø–æ 5 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º\n"
        "3. –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –∑–≤–∞–Ω–∏–µ '–ú–∞—ç—Å—Ç—Ä–æ –¥–Ω—è'!\n\n"
        "{user2}, –ø—Ä–∏–Ω–∏–º–∞–µ—à—å –≤—ã–∑–æ–≤?"
    ),
    
    'battle_results': (
        "*–†–ï–ó–£–õ–¨–¢–ê–¢–´ –ë–ò–¢–í–´!*\n\n"
        "*{winner}* –ø–æ–±–µ–∂–¥–∞–µ—Ç —Å–æ —Å—á–µ—Ç–æ–º {score1}:{score2}!\n\n"
        "*–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:*\n"
        "‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è: {energy1} üÜö {energy2}\n"
        "‚Ä¢ –¢–∞–Ω—Ü–µ–≤–∞–ª—å–Ω–æ—Å—Ç—å: {dance1} üÜö {dance2}\n"
        "‚Ä¢ –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å: {pop1} üÜö {pop2}\n"
        "‚Ä¢ –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ: {var1} üÜö {var2}\n"
        "‚Ä¢ –≠–∫—Å–∫–ª—é–∑–∏–≤–Ω–æ—Å—Ç—å: {excl1} üÜö {excl2}\n\n"
        "{winner} –ø–æ–ª—É—á–∞–µ—Ç –∑–≤–∞–Ω–∏–µ *{title}*!"
    ),
    
    'error_timeout': "–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑!",
    'error_invalid_url': "–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Å—ã–ª–∫–∞. –ü—Ä–æ–≤–µ—Ä—å —Ñ–æ—Ä–º–∞—Ç –∏ –ø–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞.",
    'error_playlist_too_big': "–ü–ª–µ–π–ª–∏—Å—Ç —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º—É–º {max} —Ç—Ä–µ–∫–æ–≤.",
    'error_service_unavailable': "–°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ.",
    'error_no_tracks': "–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Ç—Ä–µ–∫–∏ –≤ –ø–ª–µ–π–ª–∏—Å—Ç–µ.",
    'error_battle_declined': "–í—ã–∑–æ–≤ –æ—Ç–∫–ª–æ–Ω–µ–Ω!",
    'error_battle_no_opponent': "–£–∫–∞–∑–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–æ—Ç–∞."
}

# ==================== –ö–õ–ê–í–ò–ê–¢–£–†–´ ====================
KEYBOARDS = {
    'main': [
        ["–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç"],
        ["–ú–æ–π –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å"],
        ["–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏"],
        ["–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ –±–∏—Ç–≤—ã"],
        ["–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"],
        ["–ü–æ–º–æ—â—å"]
    ],
    
    'profile': [
        ["–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"],
        ["–ú—É–∑—ã–∫–∞–ª—å–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ"],
        ["–¢–æ–ø –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏"],
        ["–õ—é–±–∏–º—ã–µ —Ç—Ä–µ–∫–∏"],
        ["–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"]
    ],
    
    'battle': [
        ["–ù–∞—á–∞—Ç—å –±–∏—Ç–≤—É"],
        ["–ú–æ–∏ –±–∏—Ç–≤—ã"],
        ["–†–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤"],
        ["–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"]
    ],
    
    'yes_no': [
        ["–î–∞", "–ù–µ—Ç"]
    ]
}

# ==================== –°–¢–ê–¢–£–°–´ –ö–û–ù–í–ï–†–°–ê–¶–ò–ò ====================
class ConversationState(Enum):
    """–°–æ—Å—Ç–æ—è–Ω–∏—è conversation handler"""
    SELECTING_ACTION = 1
    ENTER_PLAYLIST = 2
    VIEWING_ANALYSIS = 3
    WAITING_BATTLE_RESPONSE = 4
    SELECTING_BATTLE_TRACKS = 5
    VIEWING_PROFILE = 6
    VIEWING_RECOMMENDATIONS = 7

# ==================== –ö–≠–® –ö–õ–Æ–ß–ò ====================
CACHE_KEYS = {
    'user_profile': 'user_profile_{user_id}',
    'playlist_analysis': 'playlist_{playlist_id}',
    'recommendations': 'recs_{user_id}_{genre}',
    'battle_results': 'battle_{battle_id}'
}

# ==================== –ü–ê–†–ê–ú–ï–¢–†–´ –ê–ù–ê–õ–ò–ó–ê ====================
ANALYSIS_PARAMS = {
    'energy_weights': [0.3, 0.25, 0.2, 0.15, 0.1],  # –í–µ—Å–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —ç–Ω–µ—Ä–≥–∏–∏
    'mood_thresholds': {
        'happy': (0.7, 1.0),
        'sad': (0.0, 0.3),
        'energetic': (0.6, 1.0),
        'calm': (0.0, 0.4),
        'romantic': (0.5, 0.8)
    },
    'popularity_tiers': {
        'underground': (0, 30),
        'emerging': (31, 60),
        'popular': (61, 80),
        'viral': (81, 100)
    }
}

# ==================== –ù–ê–ì–†–ê–î–´ –ò –¢–ò–¢–£–õ–´ ====================
BATTLE_TITLES = {
    'energy_king': '–ö–æ—Ä–æ–ª—å –≠–Ω–µ—Ä–≥–∏–∏',
    'dance_master': '–ú–∞—Å—Ç–µ—Ä –¢–∞–Ω—Ü–ø–æ–ª–∞',
    'taste_guru': '–ì—É—Ä—É –í–∫—É—Å–∞',
    'underground_hero': '–ì–µ—Ä–æ–π –ê–Ω–¥–µ–≥—Ä–∞—É–Ω–¥–∞',
    'hitmaker': '–•–∏—Ç–º–µ–π–∫–µ—Ä'
}

ACHIEVEMENTS = {
    'first_analysis': '–ü–µ—Ä–≤—ã–π –∞–Ω–∞–ª–∏–∑',
    'playlist_master': '–ú–∞—Å—Ç–µ—Ä –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤',
    'battle_champion': '–ß–µ–º–ø–∏–æ–Ω –±–∏—Ç–≤',
    'taste_explorer': '–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å –≤–∫—É—Å–æ–≤',
    'music_guru': '–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –≥—É—Ä—É'
}

# ==================== –ü–£–¢–ò –ò –§–ê–ô–õ–´ ====================
DATA_DIR = "data"
CACHE_DIR = os.path.join(DATA_DIR, "cache")
LOGS_DIR = "logs"
USER_DATA_FILE = os.path.join(DATA_DIR, "users.json")
BATTLE_HISTORY_FILE = os.path.join(DATA_DIR, "battles.json")
